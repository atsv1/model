package mp.parser;

/**
 * User: саша
 * Date: 13.10.2008
 */
public class Distributions {

  private static double FNormalArrayStep = 0.001;
  private static double[][] FNormalArray = {
          {-1000000,	0},
          {-3.090232306,	0.001},
          {-2.878161739,	0.002},
          {-2.747781385,	0.003},
          {-2.652069808,	0.004},
          {-2.575829304,	0.005},
          {-2.512144328,	0.006},
          {-2.45726339,	    0.007},
          {-2.408915546,	0.008},
          {-2.365618127, 	0.009},
          {-2.326347874,    0.01},
          {-2.290367878,	0.011},
          {-2.257129244,	0.012},
          {-2.226211769,	0.013},
          {-2.197286377,	0.014},
          {-2.170090378,	0.015},
          {-2.144410621,	0.016},
          {-2.12007169,	0.017},
          {-2.096927429,	0.018},
          {-2.074854734,	0.019},
          {-2.053748911,	0.02},
          {-2.033520149,	0.021},
          {-2.014090812,	0.022},
          {-1.99539331,	0.023},
          {-1.977368428,	0.024},
          {-1.959963985,	0.025},
          {-1.943133751,	0.026},
          {-1.926836573,	0.027},
          {-1.911035648,	0.028},
          {-1.895697924,	0.029},
          {-1.880793608,	0.03},
          {-1.866295743,	0.031},
          {-1.852179859,	0.032},
          {-1.838423669,	0.033},
          {-1.825006821,	0.034},
          {-1.811910673,	0.035},
          {-1.799118107,	0.036},
          {-1.786613365,	0.037},
          {-1.77438191,	0.038},
          {-1.762410298,	0.039},
          {-1.750686071,	0.04},
          {-1.739197665,	0.041},
          {-1.727934322,	0.042},
          {-1.716886018,	0.043},
          {-1.706043397,	0.044},
          {-1.69539771,	0.045},
          {-1.684940768,	0.046},
          {-1.674664889,	0.047},
          {-1.664562861,	0.048},
          {-1.654627902,	0.049},
          {-1.644853627,	0.05},
          {-1.635234015,	0.051},
          {-1.625763386,	0.052},
          {-1.616436371,	0.053},
          {-1.607247892,	0.054},
          {-1.59819314,	0.055},
          {-1.589267557,	0.056},
          {-1.580466818,	0.057},
          {-1.571786817,	0.058},
          {-1.563223647,	0.059},
          {-1.554773595,	0.06},
          {-1.546433122,	0.061},
          {-1.538198859,	0.062},
          {-1.530067588,	0.063},
          {-1.522036242,	0.064},
          {-1.514101888,	0.065},
          {-1.506261723,	0.066},
          {-1.498513068,	0.067},
          {-1.490853355,	0.068},
          {-1.483280127,	0.069},
          {-1.475791028,	0.07},
          {-1.468383798,	0.071},
          {-1.461056269,	0.072},
          {-1.453806359,	0.073},
          {-1.446632067,	0.074},
          {-1.439531471,	0.075},
          {-1.432502721,	0.076},
          {-1.425544037,	0.077},
          {-1.418653706,	0.078},
          {-1.411830078,	0.079},
          {-1.40507156,	0.08},
          {-1.398376621,	0.081},
          {-1.391743779,	0.082},
          {-1.385171608,	0.083},
          {-1.378658729,	0.084},
          {-1.372203809,	0.085},
          {-1.365805563,	0.086},
          {-1.359462745,	0.087},
          {-1.353174155,	0.088},
          {-1.346938626,	0.089},
          {-1.340755034,	0.09},
          {-1.334622287,	0.091},
          {-1.328539329,	0.092},
          {-1.322505137,	0.093},
          {-1.316518718,	0.094},
          {-1.310579112,	0.095},
          {-1.304685385,	0.096},
          {-1.298836633,	0.097},
          {-1.293031976,	0.098},
          {-1.287270563,	0.099},
          {-1.281551566,	0.1},
          {-1.275874179,	0.101},
          {-1.270237622,	0.102  },
          {-1.264641136,	0.103},
          {-1.25908398,	0.104},
          {-1.253565438,	0.105},
          {-1.248084811,	0.106},
          {-1.242641419,	0.107},
          {-1.237234599,	0.108},
          {-1.231863709,	0.109},
          {-1.22652812,	0.11},
          {-1.221227222,	0.111},
          {-1.21596042,	0.112},
          {-1.210727133,	0.113},
          {-1.205526796,	0.114},
          {-1.200358858,	0.115},
          {-1.195222781,	0.116},
          {-1.190118042,	0.117},
          {-1.185044128,	0.118},
          {-1.18000054,	0.119},
          {-1.174986792,	0.12},
          {-1.170002408,	0.121},
          {-1.165046922,	0.122},
          {-1.160119883,	0.123},
          {-1.155220847,	0.124},
          {-1.15034938,	0.125},
          {-1.145505061,	0.126},
          {-1.140687476,	0.127},
          {-1.135896221,	0.128},
          {-1.131130901,	0.129},
          {-1.126391129,	0.13},
          {-1.121676528,	0.131},
          {-1.116986728,	0.132},
          {-1.112321367,	0.133},
          {-1.107680092,	0.134},
          {-1.103062556,	0.135},
          {-1.09846842,	0.136},
          {-1.093897353,	0.137},
          {-1.089349028,	0.138},
          {-1.084823128,	0.139},
          {-1.080319341,	0.14},
          {-1.075837361,	0.141},
          {-1.071376889,	0.142},
          {-1.066937632,	0.143},
          {-1.062519302,	0.144},
          {-1.058121618,	0.145},
          {-1.053744302,	0.146},
          {-1.049387085,	0.147},
          {-1.0450497,	0.148},
          {-1.040731886,	0.149},
          {-1.036433389,	0.15 },
          {-1.032153958,	0.151},
          {-1.027893346,	0.152},
          {-1.023651312,	0.153},
          {-1.019427618,	0.154},
          {-1.015222033,	0.155},
          {-1.011034328,	0.156},
          {-1.006864279,	0.157},
          {-1.002711665,	0.158},
          {-0.998576271,	0.159},
          {-0.994457883,	0.16 },
          {-0.990356294,	0.161},
          {-0.986271299,	0.162},
          {-0.982202695,	0.163 },
          {-0.978150286,	0.164 },
          {-0.974113877,	0.165 },
          {-0.970093277,	0.166 },
          {-0.966088297,	0.167 },
          {-0.962098754,	0.168 },
          {-0.958124465,	0.169 },
          {-0.954165253,	0.17 },
          {-0.950220942,	0.171},
          {-0.946291358,	0.172},
          {-0.942376333,	0.173},
          {-0.938475698,	0.174},
          {-0.934589291,	0.175},
          {-0.930716949,	0.176},
          {-0.926858513,	0.177},
          {-0.923013826,	0.178},
          {-0.919182735,	0.179},
          {-0.915365088,	0.18},
          {-0.911560735,	0.181},
          {-0.90776953,	0.182},
          {-0.903991328,	0.183},
          {-0.900225986,	0.184},
          {-0.896473364,	0.185},
          {-0.892733324,	0.186},
          {-0.889005731,	0.187},
          {-0.885290449,	0.188},
          {-0.881587347,	0.189},
          {-0.877896295,	0.19 },
          {-0.874217165,	0.191},
          {-0.87054983,	0.192},
          {-0.866894167,	0.193},
          {-0.863250052,	0.194},
          {-0.859617364,	0.195},
          {-0.855995985,	0.196},
          {-0.852385798,	0.197},
          {-0.848786686,	0.198},
          {-0.845198535,	0.199},
          {-0.841621234,	0.2  },
          {-0.83805467,	0.201},
          {-0.834498735,	0.202},
          {-0.830953321,	0.203},
          {-0.827418321,	0.204},
          {-0.82389363,	0.205},
          {-0.820379146,	0.206},
          {-0.816874766,	0.207},
          {-0.813380388,	0.208},
          {-0.809895915,	0.209},
          {-0.806421247,	0.21 },
          {-0.802956288,	0.211},
          {-0.799500943,	0.212},
          {-0.796055117,	0.213},
          {-0.792618718,	0.214},
          {-0.789191653,	0.215},
          {-0.785773832,	0.216},
          {-0.782365165,	0.217},
          {-0.778965564,	0.218},
          {-0.775574943,	0.219},
          {-0.772193214,	0.22 },
          {-0.768820293,	0.221 },
          {-0.765456097,	0.222 },
          {-0.762100541,	0.223},
          {-0.758753545,	0.224},
          {-0.755415026,	0.225},
          {-0.752084907,	0.226},
          {-0.748763107,	0.227},
          {-0.745449548,	0.228},
          {-0.742144154,	0.229},
          {-0.738846849,	0.23 },
          {-0.735557557,	0.231},
          {-0.732276205,	0.232},
          {-0.729002718,	0.233},
          {-0.725737024,	0.234},
          {-0.722479052,	0.235},
          {-0.71922873,	    0.236},
          {-0.71598599,  	0.237},
          {-0.71275076,	    0.238},
          {-0.709522974,	0.239},
          {-0.706302563,	0.24 },
          {-0.70308946,	    0.241},
          {-0.6998836,	    0.242},
          {-0.696684917,	0.243},
          {-0.693493346,	0.244},
          {-0.690308824,	0.245},
          {-0.687131287,	0.246},
          {-0.683960672,	0.247},
          {-0.680796919,	0.248},
          {-0.677639965,	0.249},
          {-0.67448975,	    0.25 },
          {-0.671346215,	0.251},
          {-0.6682093,	    0.252},
          {-0.665078946,	0.253},
          {-0.661955096,	0.254},
          {-0.658837693,	0.255},
          {-0.655726679,	0.256},
          {-0.652621998,	0.257},
          {-0.649523596,	0.258},
          {-0.646431416,	0.259},
          {-0.643345405,	0.26 },
          {-0.640265509,	0.261},
          {-0.637191675,	0.262},
          {-0.634123849,	0.263},
          {-0.631061979,	0.264},
          {-0.628006014,	0.265},
          {-0.624955903,	0.266},
          {-0.621911596,	0.267},
          {-0.618873041,	0.268},
          {-0.615840189,	0.269},
          {-0.612812991,	0.27 },
          {-0.609791399,	0.271},
          {-0.606775364,	0.272},
          {-0.603764838,	0.273},
          {-0.600759774,	0.274 },
          {-0.597760126,	0.275 },
          {-0.594765847,	0.276},
          {-0.591776891,	0.277},
          {-0.588793212,	0.278},
          {-0.585814766,	0.279},
          {-0.582841507,	0.28 },
          {-0.579873392,	0.281},
          {-0.576910377,	0.282},
          {-0.573952419,	0.283},
          {-0.570999473,	0.284},
          {-0.568051498,	0.285},
          {-0.565108452,	0.286},
          {-0.562170292,	0.287},
          {-0.559236978,	0.288},
          {-0.556308467,	0.289},
          {-0.55338472,     0.29 },
          {-0.550465695,	0.291},
          {-0.547551353,	0.292},
          {-0.544641655,	0.293},
          {-0.54173656, 	0.294},
          {-0.53883603, 	0.295},
          {-0.535940027,	0.296},
          {-0.533048511,	0.297},
          {-0.530161445,	0.298},
          {-0.527278791,	0.299},
          {-0.524400513,	0.3 },
          {-0.521526572,	0.301},
          {-0.518656932,	0.302},
          {-0.515791557,	0.303},
          {-0.512930411,	0.304},
          {-0.510073457,	0.305},
          {-0.507220661,	0.306},
          {-0.504371986,	0.307},
          {-0.501527399,	0.308},
          {-0.498686864,	0.309},
          {-0.495850347,	0.31},
          {-0.493017814,	0.311},
          {-0.490189232,	0.312 },
          {-0.487364565,	0.313},
          {-0.484543782,	0.314},
          {-0.48172685,	    0.315},
          {-0.478913734,	0.316},
          {-0.476104403,	0.317},
          {-0.473298825,	0.318},
          {-0.470496968,	0.319},
          {-0.467698799,	0.32 },
          {-0.464904288,	0.321},
          {-0.462113402,	0.322},
          {-0.459326111,	0.323},
          {-0.456542384,	0.324},
          {-0.45376219,	    0.325},
          {-0.450985499,	0.326},
          {-0.448212281,	0.327},
          {-0.445442506,	0.328},
          {-0.442676144,	0.329},
          {-0.439913166,	0.33 },
          {-0.437153541,	0.331},
          {-0.434397242,	0.332},
          {-0.431644239,	0.333},
          {-0.428894504,	0.334},
          {-0.426148008,	0.335},
          {-0.423404722,	0.336},
          {-0.42066462,	    0.337},
          {-0.417927672,	0.338},
          {-0.415193851,	0.339},
          {-0.412463129,	0.34 },
          {-0.40973548,  	0.341},
          {-0.407010876,	0.342},
          {-0.40428929,	    0.343},
          {-0.401570696,	0.344},
          {-0.398855066,	0.345},
          {-0.396142374,	0.346},
          {-0.393432594,	0.347},
          {-0.3907257,	    0.348},
          {-0.388021666,	0.349},
          {-0.385320466,	0.35 },
          {-0.382622075,	0.351},
          {-0.379926467,	0.352},
          {-0.377233617,	0.353},
          {-0.374543499,	0.354},
          {-0.371856089,	0.355},
          {-0.369171363,	0.356},
          {-0.366489294,	0.357},
          {-0.363809859,	0.358},
          {-0.361133034,	0.359},
          {-0.358458793,	0.36 },
          {-0.355787114,	0.361},
          {-0.353117972,	0.362},
          {-0.350451343,	0.363},
          {-0.347787204,	0.364},
          {-0.345125531,	0.365},
          {-0.342466301,	0.366},
          {-0.339809491,	0.367},
          {-0.337155077,	0.368},
          {-0.334503036,	0.369},
          {-0.331853346,	0.37 },
          {-0.329205984,	0.371},
          {-0.326560927,	0.372},
          {-0.323918153,	0.373},
          {-0.32127764,	    0.374},
          {-0.318639364,	0.375},
          {-0.316003304,	0.376},
          {-0.313369439,	0.377},
          {-0.310737745,	0.378},
          {-0.308108202,	0.379},
          {-0.305480788,	0.38 },
          {-0.302855481,	0.381},
          {-0.300232259,	0.382},
          {-0.297611102,	0.383},
          {-0.294991988,	0.384},
          {-0.292374896,	0.385},
          {-0.289759805,	0.386},
          {-0.287146694,	0.387},
          {-0.284535543,	0.388},
          {-0.28192633,	    0.389},
          {-0.279319034,	0.39  },
          {-0.276713637,	0.391},
          {-0.274110116,	0.392},
          {-0.271508452,	0.393},
          {-0.268908624,	0.394},
          {-0.266310613,	0.395},
          {-0.263714398,	0.396},
          {-0.26111996,  	0.397},
          {-0.258527277,	0.398},
          {-0.255936332,	0.399},
          {-0.253347103,	0.4  },
          {-0.250759572,	0.401},
          {-0.248173718,	0.402},
          {-0.245589523,	0.403},
          {-0.243006967,	0.404},
          {-0.240426031,	0.405},
          {-0.237846695,	0.406},
          {-0.235268941,	0.407},
          {-0.232692749,	0.408},
          {-0.230118101,	0.409},
          {-0.227544977,	0.41 },
          {-0.224973358,	0.411},
          {-0.222403227,	0.412},
          {-0.219834564,	0.413},
          {-0.21726735,	    0.414},
          {-0.214701568,	0.415},
          {-0.212137198,	0.416},
          {-0.209574223,	0.417},
          {-0.207012623,	0.418},
          {-0.204452382,	0.419},
          {-0.201893479,	0.42 },
          {-0.199335898,	0.421},
          {-0.19677962,  	0.422},
          {-0.194224628,	0.423},
          {-0.191670902,	0.424},
          {-0.189118426,	0.425},
          {-0.186567182,	0.426},
          {-0.184017151,	0.427},
          {-0.181468317,	0.428},
          {-0.17892066,	    0.429},
          {-0.176374165,	0.43 },
          {-0.173828813,	0.431},
          {-0.171284586,	0.432},
          {-0.168741468,	0.433},
          {-0.16619944,	    0.434},
          {-0.163658486,	0.435},
          {-0.161118589,	0.436},
          {-0.15857973,	    0.437},
          {-0.156041893,	0.438},
          {-0.15350506,	    0.439},
          {-0.150969215,	0.44 },
          {-0.148434341,	0.441},
          {-0.14590042,	    0.442},
          {-0.143367435,	0.443},
          {-0.14083537,	    0.444},
          {-0.138304208,	0.445},
          {-0.135773931,	0.446},
          {-0.133244524,	0.447},
          {-0.130715968,	0.448},
          {-0.128188248,	0.449},
          {-0.125661347,	0.45 },
          {-0.123135248,	0.451 },
          {-0.120609934,	0.452},
          {-0.118085389,	0.453},
          {-0.115561597,	0.454},
          {-0.113038541,	0.455},
          {-0.110516204,	0.456},
          {-0.107994569,	0.457},
          {-0.105473622,	0.458},
          {-0.102953344,	0.459},
          {-0.100433721,	0.46 },
          {-0.097914734,	0.461},
          {-0.095396369,	0.462},
          {-0.092878609,	0.463},
          {-0.090361437,	0.464},
          {-0.087844838,	0.465},
          {-0.085328795,	0.466},
          {-0.082813292,	0.467},
          {-0.080298313,	0.468},
          {-0.077783842,	0.469},
          {-0.075269862,	0.47 },
          {-0.072756358,	0.471},
          {-0.070243314,	0.472},
          {-0.067730713,	0.473},
          {-0.06521854,	    0.474},
          {-0.062706778,	0.475},
          {-0.060195412,	0.476},
          {-0.057684425,	0.477},
          {-0.055173802,	0.478},
          {-0.052663527,	0.479},
          {-0.050153583,	0.48 },
          {-0.047643956,	0.481},
          {-0.045134628,	0.482},
          {-0.042625585,	0.483},
          {-0.04011681,	    0.484},
          {-0.037608288,	0.485},
          {-0.035100002,	0.486},
          {-0.032591937,	0.487},
          {-0.030084077,	0.488},
          {-0.027576406,	0.489},
          {-0.025068908,	0.49 },
          {-0.022561568,	0.491},
          {-0.02005437,  	0.492},
          {-0.017547298,	0.493},
          {-0.015040337,	0.494},
          {-0.01253347, 	0.495},
          {-0.010026681,	0.496},
          {-0.007519956,	0.497},
          {-0.005013278,	0.498},
          {-0.002506631,	0.499},
          {0,	0.5}
  };


  public static double GetNormalDistribution( double mu, double sigma ) throws ScriptException{
    double rndValue = Math.random();
    return GetNormalDistribution(mu, sigma, rndValue);
  }

  private static double GetNormal_LittleValues( double mu, double sigma, double rndValue ){
    double t,nom, den;
    double res;
    double c_0 = 2.515517;
    double c_1 = 0.802853;
    double c_2 = 0.010328;

    double d_1 = 1.432788;
    double d_2 = 0.189269;
    double d_3 = 0.001308;

    t = Math.sqrt(-2 * Math.log( rndValue ));
    nom = c_0 + c_1*t + c_2 * t*t;
    den = 1 + d_1*t + d_2*t*t + d_3 *t*t*t;
    res = nom/den - t;
    return mu + res * sigma;
  }

  public static double GetNormalDistribution( double mu, double sigma, double rndValue ) throws ScriptException{
    if ( rndValue < 0 ) {
      rndValue = rndValue * -1;
    }
    if ( rndValue > 1 ){
      rndValue = rndValue - (int)rndValue;
    }
    boolean flag = false;
    if ( rndValue > 0.5 ) {
      rndValue = 1 - rndValue;
      flag = true;
    }
    if ( rndValue <  0.001){
      return GetNormal_LittleValues(mu, sigma, rndValue);
    }
    int a = (int)(rndValue*1000);
    double rndValue2 = rndValue * 1000 - a;
    int arrLength = FNormalArray.length;
    int pos = (int) (rndValue / FNormalArrayStep);
    if ( pos < 0 || ( pos + 1>=  arrLength) ) {
      pos =  arrLength / 2 ;
    }
    while ( pos >=  arrLength ){
      pos =  arrLength / 2 ;
    }
    double lowValue, upValue;
    lowValue = FNormalArray[pos][0];
    /*if ( pos >= 500 ) {
      System.out.println( "123" );
    }*/
    upValue = FNormalArray[pos+1][0];
    double a1 = FNormalArray[pos][1];
    double a2 = FNormalArray[pos+1][1];
    double interpolatedValue = 0;
    interpolatedValue = lowValue + ( (rndValue - a1)/(a2-a1) )  * ( upValue - lowValue );
    if ( interpolatedValue > upValue || interpolatedValue < lowValue ) {
      System.out.println( "interpolate error interpvalue = " + Double.toString( interpolatedValue )  +
         " upValue=" + Double.toString( upValue ) + " lowValue=" + Double.toString( lowValue ));
    }
    if ( flag ) {
      interpolatedValue = mu - interpolatedValue * sigma;
    }  else {
      interpolatedValue = mu + interpolatedValue * sigma;
    }
    /*
    if ( Math.abs( interpolatedValue ) > 4 ) {
      ScriptException e = new ScriptException(" normal distr =  " + Double.toString(interpolatedValue) );
      throw e;
    }
    */
    return interpolatedValue;

  }

}
